.text-center
  %h4.mb-2
    ご注文内容の確認
  %p.text-muted.mb-5 内容をご確認のうえ「注文を確定する」ボタンをクリックしてください。
- if @purchase.errors.present?
  .alert.alert-danger
    - @purchase.errors.full_messages.each do |message|
      %p.mb-0= message
.row
  .col-md-8.mb-3
    .card
      %h6.card-header
        ご注文内容
      .card-body
        .row.mb-4
          .col-md-6
            %h6
              ご請求先
              %span.small.ml-2= link_to '変更', member_invoice_address_path(purchase: true)
            %hr.mt-2.mb-2
            %p.pl-2= render 'addresses/body', address: @purchase.invoice_address
          .col-md-6
            %h6
              お届け先
              %span.small.ml-2= link_to '変更', member_delivery_addresses_path(purchase: true)
            %hr.mt-2.mb-2
            %p.pl-2
              - if @purchase.invoice_address.id == @purchase.delivery_address.id
                ご請求先と同じ
              - else
                = render 'addresses/body', address: @purchase.delivery_address
        .mb-5
          %h6
            お支払い方法
            %span.small.ml-2= link_to '変更', member_credit_cards_path(purchase: true)
          %hr.mt-2.mb-2
            %p.pl-2= @purchase.credit_card_info
        %h6 ご注文商品・数量
        - 5.times do
          - @purchase.details.each do |detail|
            %hr.mt-0
            .row
              .col-5.col-lg-3
                = image_tag detail.item.caption_image_url, class: 'img-fluid'
              .col-7.col-lg-9
                %h6= detail.item.name
                %p.view_pc= detail.item.description
                %p.mt-3= "#{jpy(detail.item.price, prefix: true, tax: :exclude)}  数量:#{detail.quantity}"
  .col-md-4
    .sticky-top{style: 'z-index: 0'}
      = form_for @purchase do |f|
        - %i(invoice_last_name invoice_first_name invoice_phone invoice_postal_code invoice_prefecture_id invoice_address1 invoice_address2 delivery_last_name delivery_first_name delivery_phone delivery_postal_code delivery_prefecture_id delivery_address1 delivery_address2 invoice_address_id delivery_address_id credit_card_id).each do |elem|
          = f.hidden_field elem
        = f.fields_for :details do |d|
          - %i(item_id item_name price quantity).each do |elem|
            = d.hidden_field elem
        .card
          .card-body
            = f.submit '注文を確定する', class: 'btn btn-raised btn-warning btn-block'
            %table.table.mt-4
              %tr
                %td 商品の小計:
                %td.text-right= jpy(@purchase.item_amount, prefix: true)
              %tr
                %td 送料:
                %td.text-right= jpy(@purchase.delivery_fee, prefix: true)
              %tr
                %td 消費税:
                %td.text-right= jpy(@purchase.tax, prefix: true)
              %tr.text-info
                %td ご請求金額合計:
                %td.text-right= jpy(@purchase.total_amount, prefix: true)
